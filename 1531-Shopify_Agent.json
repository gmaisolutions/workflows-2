{
  "name": "Shopify",
  "nodes": [
    {
      "parameters": {
        "method": "POST",
        "url": "=https://{{ $('Entrada WhatsApp').item.json.serverUrl }}/chat/getBase64FromMediaMessage/{{ $('Entrada WhatsApp').item.json.instanceName }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "={{ $('Entrada WhatsApp').item.json.apiKey }}"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "message.key.id",
              "value": "={{ $json.messageId }}"
            },
            {
              "name": "convertToMp4",
              "value": "={{ Boolean(false) }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        320,
        240
      ],
      "id": "2a08d03c-f2df-418a-a0b0-266e3d920866",
      "name": "descargar audio"
    },
    {
      "parameters": {
        "operation": "toBinary",
        "sourceProperty": "base64",
        "options": {
          "mimeType": "={{ $json.mimetype }}"
        }
      },
      "type": "n8n-nodes-base.convertToFile",
      "typeVersion": 1.1,
      "position": [
        540,
        240
      ],
      "id": "96bb9f28-7d13-4877-9313-06fe956a47df",
      "name": "convertir audio"
    },
    {
      "parameters": {
        "resource": "audio",
        "operation": "transcribe",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.8,
      "position": [
        760,
        240
      ],
      "id": "0af1bbaa-d68d-40c7-9055-25a242d3ec65",
      "name": "OpenAI",
      "credentials": {
        "openAiApi": {
          "id": "qLM5Iy3mjllZuUML",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://{{ $('Entrada WhatsApp').item.json.serverUrl }}/chat/getBase64FromMediaMessage/{{ $('Entrada WhatsApp').item.json.instanceName }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "={{ $('Entrada WhatsApp').item.json.apiKey }}"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "message.key.id",
              "value": "={{ $json.messageId }}"
            },
            {
              "name": "convertToMp4",
              "value": "={{ Boolean(false) }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        360,
        460
      ],
      "id": "7382385a-3378-4173-a5c4-4d7af96294e9",
      "name": "descargar imagen"
    },
    {
      "parameters": {
        "operation": "toBinary",
        "sourceProperty": "base64",
        "options": {
          "mimeType": "={{ $json.mimetype }}"
        }
      },
      "type": "n8n-nodes-base.convertToFile",
      "typeVersion": 1.1,
      "position": [
        580,
        460
      ],
      "id": "38475efb-4dd2-4901-8abd-ff0316d48c3d",
      "name": "convertir imagen"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "a54b459d-e8df-47e1-be8c-a8a476ab93c3",
              "name": "content",
              "value": "={{ $json.text }}",
              "type": "string"
            },
            {
              "id": "1b078c6c-6824-43e2-8bff-8a56fca7a1c9",
              "name": "timestamp",
              "value": "={{ $('Json Parse').item.json.messageTimeStamp }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        980,
        240
      ],
      "id": "7efb6464-0adf-4f04-852d-b40b1f8df4f4",
      "name": "audio content"
    },
    {
      "parameters": {
        "resource": "image",
        "operation": "analyze",
        "modelId": {
          "__rl": true,
          "value": "gpt-4o-mini",
          "mode": "list",
          "cachedResultName": "GPT-4O-MINI"
        },
        "text": "Describe la imagen",
        "inputType": "base64",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.8,
      "position": [
        800,
        460
      ],
      "id": "687e6eb5-a798-4903-95a2-a80e6a54c6a7",
      "name": "describe imagen",
      "credentials": {
        "openAiApi": {
          "id": "qLM5Iy3mjllZuUML",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "a54b459d-e8df-47e1-be8c-a8a476ab93c3",
              "name": "content",
              "value": "=<image>\n{{ $json.content }}\n</image>",
              "type": "string"
            },
            {
              "id": "29e2c943-8bb0-4199-84dd-16d098894ddd",
              "name": "timestamp",
              "value": "={{ $('Json Parse').item.json.messageTimeStamp }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        980,
        460
      ],
      "id": "757c84c6-6944-45b1-bc3f-669021c164a3",
      "name": "image content"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "bcea6c99-72fa-44d3-acc6-ecfdec887583",
              "name": "content",
              "value": "={{ $json.messageContent }}",
              "type": "string"
            },
            {
              "id": "6abb6aff-1f4a-4ab5-aece-c2bf1d27a59d",
              "name": "timestamp",
              "value": "={{ $('Json Parse').item.json.messageTimeStamp }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        980,
        680
      ],
      "id": "930b05f5-3139-44c5-acaa-4c5de044559a",
      "name": "text content"
    },
    {
      "parameters": {
        "operation": "push",
        "list": "={{ $('Entrada WhatsApp').item.json.message.chatId }}",
        "messageData": "={{ JSON.stringify($('Entrada WhatsApp').item.json.message) }}",
        "tail": true
      },
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        -1880,
        540
      ],
      "id": "ebe4458e-b5f2-4371-9f9e-d30f0e2b71d5",
      "name": "push mensaje",
      "credentials": {
        "redis": {
          "id": "YA7nQxrWzSTrr6nV",
          "name": "Redis account"
        }
      }
    },
    {
      "parameters": {
        "fieldToSplitOut": "message",
        "options": {}
      },
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        -600,
        500
      ],
      "id": "0fd6c89d-cf71-4a28-b13b-68f11360c5fc",
      "name": "Split Out"
    },
    {
      "parameters": {
        "mode": "raw",
        "jsonOutput": "={{ JSON.parse($json.message) }}",
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -340,
        500
      ],
      "id": "a854f899-e7c6-4afb-bdb2-6fa1129cfea1",
      "name": "Json Parse"
    },
    {
      "parameters": {
        "numberInputs": 3
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.1,
      "position": [
        1600,
        400
      ],
      "id": "f5505d11-13d1-4523-b437-2c06bb560b30",
      "name": "Merge"
    },
    {
      "parameters": {
        "sortFieldsUi": {
          "sortField": [
            {
              "fieldName": "timestamp"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.sort",
      "typeVersion": 1,
      "position": [
        1820,
        400
      ],
      "id": "23e9ed04-0aa0-48aa-848d-95a7d6c1a923",
      "name": "Sort"
    },
    {
      "parameters": {
        "fieldsToAggregate": {
          "fieldToAggregate": [
            {
              "fieldToAggregate": "content",
              "renameField": true,
              "outputFieldName": "messages"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        2040,
        400
      ],
      "id": "9380fb57-4f79-442c-8ec2-fdc546b7c7d7",
      "name": "Aggregate"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "18445dcf-1967-40d1-aec2-6d2196b1364b",
              "leftValue": "={{ JSON.parse($json.message.last()).messageId }}",
              "rightValue": "={{ $('Entrada WhatsApp').item.json.message.messageId }}",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -1180,
        540
      ],
      "id": "f33b5eb0-53a1-4f5e-aef0-958b10116bf3",
      "name": "If"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        -900,
        780
      ],
      "id": "c10d793a-5fc2-46a7-81da-f2854df85b90",
      "name": "No Operation, do nothing"
    },
    {
      "parameters": {
        "operation": "get",
        "propertyName": "message",
        "key": "={{ $('Entrada WhatsApp').item.json.message.chatId }}",
        "options": {}
      },
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        -1440,
        540
      ],
      "id": "b1d54fba-f35f-492c-b70c-9cf44e0ba7ad",
      "name": "obtener todos mensajes",
      "credentials": {
        "redis": {
          "id": "YA7nQxrWzSTrr6nV",
          "name": "Redis account"
        }
      }
    },
    {
      "parameters": {
        "operation": "delete",
        "key": "={{ $('Entrada WhatsApp').item.json.message.chatId }}"
      },
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        -860,
        500
      ],
      "id": "94286e93-feed-475e-8a7c-4f8e9d936362",
      "name": "borrar todos mensajes",
      "credentials": {
        "redis": {
          "id": "YA7nQxrWzSTrr6nV",
          "name": "Redis account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserAutofixing",
      "typeVersion": 1,
      "position": [
        3760,
        620
      ],
      "id": "7b7c1108-dd7d-4a2f-a0a1-7bf11cea80bb",
      "name": "Auto-fixing Output Parser"
    },
    {
      "parameters": {
        "jsonSchemaExample": "{\n\t\"response\": {\n      \"part_1\": \"Parte uno de la respuesta\",\n      \"part_2\": \"Parte dos de la respuesta (opcional).\",\n      \"part_3\": \"Parte tres de la respuesta (opcional).\"\n    }\n}"
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.2,
      "position": [
        3960,
        840
      ],
      "id": "413fa7aa-a89a-453b-9e71-09253cf29398",
      "name": "Structured Output Parser"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Texto de entrada:\n{{ $json.output }}",
        "hasOutputParser": true,
        "messages": {
          "messageValues": [
            {
              "message": "=## Rol\nEres un formateador de salidas para WhatsApp y Telegram.\n\n## Objetivo\nToma el texto de la entrada y devuelve la salida en formato JSON como te describo en el Output Parser. Debes dividir la salida en 3 partes, pero solo una parte es obligatoria. Si la respuesta es corta, la part_2 y la part_3 pueden ir vacías.\n\n\n## Reglas\npart_1 debe contener siempre texto. part_2 y part_3 pueden quedar vacías (\"\") o no incluirse si no son necesarias.\n\nJamás devuelvas en la salida algo que no venta del input de la entrada.\n\nLas partes no deben tener más de tres frases.\n\nAsegúrate que la respuesta es en idioma Español de España.\n\nDivide la entrada en hasta 3 partes lógicas, manteniendo el sentido original.\n\nSi la entrada contiene una lista, deposítala entera en una única parte.\n\nNo añadas, quites ni reordenes información.\n\nNunca envies texto fuera del JSON; ni explicaciones ni comillas traza.\n\n## Ejemplo simple\n\nEntrada:\nHola, estoy aquí para ayudarte. ¿En qué puedo asistirte hoy?\n\nSalida esperada:\n\n{\n  \"response\": {\n    \"part_1\": \"Hola, estoy aquí para ayudarte.\",\n    \"part_2\": \"En qué puedo asistirte hoy?\",\n    \"part_3\": \"\"\n  }\n}\n"
            }
          ]
        }
      },
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.6,
      "position": [
        3680,
        400
      ],
      "id": "638fa2da-7d46-4a00-9dd8-7ed98407da25",
      "name": "Verificador de Respuesta",
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4o-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        3660,
        820
      ],
      "id": "a33fa996-67c0-431b-997c-c094cac29ab8",
      "name": "4o mini Verificador",
      "credentials": {
        "googlePalmApi": {
          "id": "NdyPXiyPUwmqADX5",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://{{ $('Entrada WhatsApp').first().json.serverUrl }}/message/sendText/{{ $('Entrada WhatsApp').first().json.instanceName }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "={{ $('Entrada WhatsApp').first().json.apiKey }}"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "number",
              "value": "={{ $('Entrada WhatsApp').first().json.message.chatId }}"
            },
            {
              "name": "text",
              "value": "={{ $('Verificador de Respuesta').first().json.output.response.part_1 }}"
            },
            {
              "name": "delay",
              "value": "={{ 2000 }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        4060,
        400
      ],
      "id": "8945f35d-a377-4b16-8a98-37778841d111",
      "name": "Enviar Parte1"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "4b92a1f4-d4bc-4689-87cf-1be40aa49c27",
              "leftValue": "={{ $('Verificador de Respuesta').item.json.output.response.part_2 }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        4280,
        400
      ],
      "id": "e93132e2-1dbe-4729-94d7-b60e0cb4d2e6",
      "name": "If Parte 2"
    },
    {
      "parameters": {
        "amount": "={{ 2+$('Verificador de Respuesta').item.json.output.response.part_2.length*0.01 }}"
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        4520,
        300
      ],
      "id": "dd3b0f63-7338-4ba6-b0c6-c361e8a3f7b5",
      "name": "Wait",
      "webhookId": "fccc56ac-adbb-4a82-9af6-1f3a00fa08ff"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://{{ $('Entrada WhatsApp').first().json.serverUrl }}/message/sendText/{{ $('Entrada WhatsApp').first().json.instanceName }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "={{ $('Entrada WhatsApp').first().json.apiKey }}"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "number",
              "value": "={{ $('Entrada WhatsApp').first().json.message.chatId }}"
            },
            {
              "name": "text",
              "value": "={{ $('Verificador de Respuesta').first().json.output.response.part_2 }}"
            },
            {
              "name": "delay",
              "value": "={{ 2000 }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        4720,
        300
      ],
      "id": "f7518955-977d-4ac3-9de0-9dc963966cdd",
      "name": "Enviar Parte2"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "4b92a1f4-d4bc-4689-87cf-1be40aa49c27",
              "leftValue": "={{ $('Verificador de Respuesta').item.json.output.response.part_3 }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        5000,
        420
      ],
      "id": "6f07e527-5812-412a-a5ed-c276c6dbe05e",
      "name": "If Parte 3"
    },
    {
      "parameters": {
        "amount": "={{ 2+$('Verificador de Respuesta').item.json.output.response.part_3.length*0.01 }}"
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        5220,
        300
      ],
      "id": "eb919790-a40e-4392-b0cb-4722cf91458f",
      "name": "Wait2",
      "webhookId": "610f359e-8fe3-480f-9042-e011a3c9fb43"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://{{ $('Entrada WhatsApp').first().json.serverUrl }}/message/sendText/{{ $('Entrada WhatsApp').first().json.instanceName }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "={{ $('Entrada WhatsApp').first().json.apiKey }}"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "number",
              "value": "={{ $('Entrada WhatsApp').first().json.message.chatId }}"
            },
            {
              "name": "text",
              "value": "={{ $('Verificador de Respuesta').first().json.output.response.part_3 }}"
            },
            {
              "name": "delay",
              "value": "={{ 2000 }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        5460,
        300
      ],
      "id": "06d1d615-6ff8-497d-900e-15f22f1ad8f2",
      "name": "Enviar Parte3"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        5700,
        440
      ],
      "id": "755a46e6-67fc-4028-b6a8-100ba624d9a2",
      "name": "No Operation, do nothing1"
    },
    {
      "parameters": {
        "content": "# Encolamiento de Mensajes",
        "height": 920,
        "width": 1760
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -1940,
        180
      ],
      "id": "551baa89-4ebe-42e6-8909-3116fed751b1",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "content": "# Procesamiento del Mensaje (Texto, Audio, Imagen)",
        "height": 1100,
        "width": 2360,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -100,
        100
      ],
      "id": "fd94805e-3eb0-45c5-9b87-a7cb49107b91",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "content": "# Entrada WhatsApp",
        "height": 480,
        "width": 460,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -2440,
        340
      ],
      "id": "e2a6dcdb-624a-4e6d-9948-1930602c47df",
      "name": "Sticky Note2"
    },
    {
      "parameters": {
        "content": "# Agente Ecommerce",
        "height": 1340,
        "width": 1240,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        2300,
        80
      ],
      "id": "fa174011-df36-4ff4-a972-36a23993eae0",
      "name": "Sticky Note3"
    },
    {
      "parameters": {
        "content": "# Formato de Respuesta por WhatsApp",
        "height": 1220,
        "width": 2440,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        3580,
        80
      ],
      "id": "979442f3-74c5-4c98-81a0-d40d7bdfe448",
      "name": "Sticky Note4"
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $('Entrada WhatsApp').first().json.message.chatId }}",
        "contextWindowLength": 15
      },
      "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
      "typeVersion": 1.3,
      "position": [
        2440,
        980
      ],
      "id": "60b9651a-2436-49c6-b8aa-731cdbcfb8fa",
      "name": "Postgres Chat Memory",
      "credentials": {
        "postgres": {
          "id": "HoooGLNqE6GLB7Do",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Mensaje del Usuario:\n{{ $json.content }}",
        "options": {
          "systemMessage": "=# Identidad\n\nEres un asistente inteligente para una ecommerce de ropa. Tu misión es realizar acciones en shopify a través de tus herramientas.\n\n\n# Herramientas\n\n* \"Obtener Pedidos\": utiliza esta herramienta para obtener todos los pedidos entre dos fechas.\n* \"Editar Pedido\": utiliza esta herramienta para modificar un pedido.\n* \"ObtenerProductos\": utiliza esta herramienta para obtener productos.\n* \"Get Producto\": utiliza esta herramienta siempre después de la herramienta \"ObtenerProductos\" para obtener un producto concreto a través de su ID. \n* \"Editar Productos\": utiliza esta herramienta para editar un producto.\n* \"Crear Producto\": utiliza esta herramienta para crear productos.\n* \"Think\": utiliza esta herramienta para mejorar tus acciones y respuestas.\n* \"Calculator\": utiliza esta herramienta para realizar operaciones matemáticas.\n\n# Comportamiento:\n\n* Cuando te pidan que busques pedidos por algún filtro que no conozcas, por ejemplo por su nombre, lo que tienes que hacer es usar la herramienta \"Obtener Pedidos\" y traerte todos los pedidos, y una vez que ya tienes información de todos los pedidos, solo le entregas el que corresponda con los datos que te ha suministrado.\n\n* Cuando te pidan buscar productos, utiliza la herramienta \"ObtenerProductos\" para encontrarlos. Esta herramienta te da el ID del producto. Posteriormente, utiliza siempre la herramienta \"Get Producto\" utilizando ese ID para obtener toda la información de ese producto.\n\n* Cuando te pidan realizar una acción sobre algún producto, primero utiliza la herramienta \"ObtenerProductos\" y busca entre todos sus resultados el producto al que hace referencia y así obtener su ID. A continuación, utiliza la herramienta \"Editar Productos\" buscando a través de ese ID y así modificar la información de la consulta.\n\n* Cuando te pidan realizar una acción sobre algún pedido, primero utiliza la herramienta \"Obtener Pedidos\" y busca entre to... [truncated]\n        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.8,
      "position": [
        2760,
        400
      ],
      "id": "0f20092c-8d66-4adc-94af-8b86c7e8b4f4",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.5-flash-preview-04-17-thinking",
        "options": {
          "temperature": 0.1,
          "topP": 0.9
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        2400,
        720
      ],
      "id": "f547f9d3-be9c-4be4-916a-ff77fd4406de",
      "name": "Google Gemini Chat Model",
      "credentials": {
        "googlePalmApi": {
          "id": "NdyPXiyPUwmqADX5",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "24c275ee-aef2-4b03-bf22-4ca69aa05e98",
              "name": "serverUrl",
              "value": "={{ $json.body.server_url }}",
              "type": "string"
            },
            {
              "id": "a15eb467-42de-4299-a389-667647ccc613",
              "name": "instanceName",
              "value": "={{ $json.body.instance }}",
              "type": "string"
            },
            {
              "id": "13f6d482-fb2d-42a2-958e-e82273d6679c",
              "name": "apiKey",
              "value": "={{ $json.body.apikey }}",
              "type": "string"
            },
            {
              "id": "557486dd-9057-4d07-8c8a-19583a79b9f9",
              "name": "message.messageId",
              "value": "={{ $json.body.data.key.id }}",
              "type": "string"
            },
            {
              "id": "79493ec9-a117-496c-88bf-65254c376d20",
              "name": "message.chatId",
              "value": "={{ $json.body.data.key.remoteJid }}",
              "type": "string"
            },
            {
              "id": "1208a065-1670-40c7-9b9d-5c8c87cedd3f",
              "name": "message.messageType",
              "value": "={{ $json.body.data.message.conversation ? 'text': '' }}{{ $json.body.data.message.extendedTextMessage ? 'text': '' }}{{ $json.body.data.message.audioMessage ? 'audio': '' }}{{ $json.body.data.message.imageMessage ? 'image': '' }}",
              "type": "string"
            },
            {
              "id": "2e0a8ca5-35b9-4d4d-9005-1e66ac828eeb",
              "name": "message.messageContent",
              "value": "={{ $json.body.data.message.extendedTextMessage?.text || '' }}{{ $json.body.data.message.imageMessage?.caption || '' }}{{ $json.body.data.message.conversation || '' }}",
              "type": "string"
            },
            {
              "id": "2f72443f-eace-44fa-8a81-5f3bf1ab5e88",
              "name": "message.messageTimeStamp",
              "value": "={{ $json.body.date_time.toDateTime().toISO() }}",
              "type": "string"
            },
            {
              "id": "a8c0f64c-2ad7-42c8-9af0-eb792f298cdd",
              "name": "userName",
              "value": "={{ $json.body.data.pushName }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -2100,
        540
      ],
      "id": "ebe51978-fbb1-4f8c-b225-c279d7fc696f",
      "name": "Entrada WhatsApp"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "ad567ab3-81ea-45d6-a2e3-a6a9dd204a05",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -2340,
        540
      ],
      "id": "8fd53f5a-63a5-4ce0-b1e6-cc24c910af34",
      "name": "Webhook-WhatsApp",
      "webhookId": "ad567ab3-81ea-45d6-a2e3-a6a9dd204a06"
    },
    {
      "parameters": {
        "amount": 10
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        -1680,
        540
      ],
      "id": "f88c3ed5-2c40-4262-8899-2a1ab1fd35d7",
      "name": "Wait3",
      "webhookId": "39be8185-9563-41b4-84d8-3f7650c1b4bf"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.messageType }}",
                    "rightValue": "audio",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "e397999f-f0d4-47db-8619-c188b5e3616b"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "audio"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "338e3688-336d-4e2a-a3a9-d81e6bbd4e11",
                    "leftValue": "={{ $json.messageType }}",
                    "rightValue": "image",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "image"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "b8f82334-7775-4e5d-9d7c-f6402af55910",
                    "leftValue": "={{ $json.messageType }}",
                    "rightValue": "text",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "text"
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra",
          "renameFallbackOutput": "other"
        }
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -40,
        480
      ],
      "id": "bb2f33cb-b8d1-41f2-9a69-444119f864aa",
      "name": "Tipo Mensaje"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "d2599831-cc84-4aa6-acf7-77ed624f72ab",
              "name": "content",
              "value": "={{ $json.messages.join("\n") }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        2340,
        400
      ],
      "id": "e5ff03e5-a86e-47cc-897b-7a427f3940e6",
      "name": "Entrada Agente"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "3dba318d-06ad-4151-aedd-a58a7f4029d0",
              "name": "output",
              "value": "={{ $json.output }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        3380,
        400
      ],
      "id": "91b0cb4a-a615-4982-b110-eadaef2eb613",
      "name": "Salida Agente"
    },
    {
      "parameters": {
        "jsCode": "// Este Function node recibe items que contienen en item.json.output\n// con la cadena que queremos limpiar y escapar.\n\nreturn items.map(item => {\n  const originalText = item.json.output;\n\n  // 1. Limpiezas iniciales:\n  let cleaned = originalText\n    .replace(/\\/g, '\\\\\\')  // escapamos backslashes\n    .replace(/\"/g, '\\\"')    // escapamos comillas dobles\n    .replace(/\\r/g, '\\\\r')   // escapamos carriage returns\n    .replace(/\\n/g, '\\\\n')   // escapamos newlines\n    .replace(/\\t/g, '\\\\t');  // escapamos tabs\n    \n\n  return {\n    output: cleaned\n  };\n});\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        3180,
        400
      ],
      "id": "9a1d688d-a916-44cc-9948-5efd605e2c95",
      "name": "Limpiar Salida"
    },
    {
      "parameters": {
        "authentication": "accessToken",
        "operation": "getAll",
        "options": {
          "createdAtMin": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Created_At_Min', ``, 'string') }}",
          "createdAtMax": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Created_At_Max', ``, 'string') }}"
        }
      },
      "type": "n8n-nodes-base.shopifyTool",
      "typeVersion": 1,
      "position": [
        2740,
        840
      ],
      "id": "b25d6d03-947b-4e03-9be6-fcde4687271c",
      "name": "Obtener Pedidos",
      "credentials": {
        "shopifyAccessTokenApi": {
          "id": "j1Nys3HNLxhnIk7y",
          "name": "Shopify Access Token account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "accessToken",
        "operation": "update",
        "orderId": "={{ $fromAI('Order_ID', ``, 'string') ?? '' }}",
        "updateFields": {
          "email": "={{ $fromAI('Email', ``, 'string') ?? '' }}",
          "locationId": 107973280073,
          "note": "={{ $fromAI('Note', ``, 'string') ?? '' }}",
          "shippingAddressUi": {
            "shippingAddressValues": {
              "firstName": "={{ $fromAI('First_Name', ``, 'string') ?? '' }}",
              "lastName": "={{ $fromAI('Last_Name', ``, 'string') ?? '' }}",
              "company": "={{ $fromAI('Company', ``, 'string') ?? '' }}",
              "country": "={{ $fromAI('Country', ``, 'string') ?? '' }}",
              "address1": "={{ $fromAI('Address_Line_1', ``, 'string') ?? '' }}",
              "address2": "={{ $fromAI('Address_Line_2', ``, 'string') ?? '' }}",
              "city": "={{ $fromAI('City', ``, 'string') ?? '' }}",
              "province": "={{ $fromAI('Province', ``, 'string') ?? '' }}",
              "zip": "={{ $fromAI('Zip_Code', ``, 'string') ?? '' }}",
              "phone": "={{ $fromAI('Phone', ``, 'string') ?? '' }}"
            }
          },
          "sourceName": "={{ $fromAI('Source_Name', ``, 'string') ?? '' }}",
          "tags": "={{ $fromAI('Tags', ``, 'string') ?? '' }}"
        }
      },
      "type": "n8n-nodes-base.shopifyTool",
      "typeVersion": 1,
      "position": [
        2880,
        840
      ],
      "id": "10b3a7f7-06c6-4604-a106-498ad324963f",
      "name": "Editar Pedido",
      "credentials": {
        "shopifyAccessTokenApi": {
          "id": "j1Nys3HNLxhnIk7y",
          "name": "Shopify Access Token account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "accessToken",
        "resource": "product",
        "operation": "update",
        "productId": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Product_ID', ``, 'string') }}",
        "updateFields": {
          "body_html": "={{ $fromAI('Body_HTML', ``, 'string') ?? '' }}",
          "title": "={{ $fromAI('Title', ``, 'string') ?? '' }}"
        }
      },
      "type": "n8n-nodes-base.shopifyTool",
      "typeVersion": 1,
      "position": [
        3240,
        1120
      ],
      "id": "08e43503-f753-41c3-b19d-642cfc5829a4",
      "name": "Editar Producto",
      "credentials": {
        "shopifyAccessTokenApi": {
          "id": "j1Nys3HNLxhnIk7y",
          "name": "Shopify Access Token account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "accessToken",
        "resource": "product",
        "title": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Title', ``, 'string') }}",
        "additionalFields": {
          "body_html": "={{ $fromAI('Body_HTML', ``, 'string') ?? '' }}",
          "product_type": "={{ $fromAI('Product_Type', ``, 'string') ?? '' }}"
        }
      },
      "type": "n8n-nodes-base.shopifyTool",
      "typeVersion": 1,
      "position": [
        3440,
        1100
      ],
      "id": "f4086c5e-2d9d-428f-abb4-87daa83ec2da",
      "name": "Crear Producto",
      "credentials": {
        "shopifyAccessTokenApi": {
          "id": "j1Nys3HNLxhnIk7y",
          "name": "Shopify Access Token account"
        }
      }
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.toolThink",
      "typeVersion": 1,
      "position": [
        3320,
        680
      ],
      "id": "3670eaa6-c988-4779-8760-f2e27d729329",
      "name": "Think"
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.toolCalculator",
      "typeVersion": 1,
      "position": [
        3460,
        680
      ],
      "id": "4b59a428-d1ad-4408-ae19-eef2df301892",
      "name": "Calculator"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        680,
        -320
      ],
      "id": "46c2c283-f91b-4ba5-b3b8-59f20a5a3789",
      "name": "When clicking ‘Execute workflow’"
    },
    {
      "parameters": {
        "authentication": "accessToken",
        "resource": "product",
        "operation": "getAll",
        "returnAll": true,
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.shopify",
      "typeVersion": 1,
      "position": [
        920,
        -320
      ],
      "id": "9564e502-d056-4752-9a1e-80e9d233abeb",
      "name": "Shopify",
      "credentials": {
        "shopifyAccessTokenApi": {
          "id": "j1Nys3HNLxhnIk7y",
          "name": "Shopify Access Token account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "2cafc516-b807-45d5-8da2-90af5f31c8c7",
              "name": "id",
              "value": "={{ $json.id }}",
              "type": "string"
            },
            {
              "id": "710922ab-0d3b-4392-adaa-b3e9846b92ad",
              "name": "title",
              "value": "={{ $json.title }}",
              "type": "string"
            },
            {
              "id": "cbf7c76c-f074-45e9-917c-7a5a920c3530",
              "name": "descripcion",
              "value": "={{ $json.body_html }}",
              "type": "string"
            },
            {
              "id": "56bddfe0-1353-479d-a1fc-8786131f0c39",
              "name": "tipo_producto",
              "value": "={{ $json.product_type }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1180,
        -320
      ],
      "id": "4641b4cb-46c3-4720-b2eb-99da819a9acf",
      "name": "Edit Fields"
    },
    {
      "parameters": {
        "mode": "insert",
        "qdrantCollection": {
          "__rl": true,
          "value": "shopify",
          "mode": "id"
        },
        "embeddingBatchSize": {},
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreQdrant",
      "typeVersion": 1.2,
      "position": [
        1720,
        -320
      ],
      "id": "7f5b483e-9786-4137-81ed-09bfc4ad79a5",
      "name": "Qdrant Vector Store",
      "credentials": {
        "qdrantApi": {
          "id": "rg2NHi83Wt2pkwYi",
          "name": "QdrantApi account"
        }
      }
    },
    {
      "parameters": {
        "model": "text-embedding-3-large",
        "options": {
          "dimensions": 1536
        }
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        1600,
        -120
      ],
      "id": "fca3fd0b-1172-45d3-a772-971d2b006fc5",
      "name": "Embeddings OpenAI",
      "credentials": {
        "openAiApi": {
          "id": "qLM5Iy3mjllZuUML",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "jsonMode": "expressionData",
        "jsonData": "={{ $('Edit Fields').item.json.title }}{{ $('Edit Fields').item.json.descripcion }}{{ $('Edit Fields').item.json.tipo_producto }}",
        "options": {
          "metadata": {
            "metadataValues": [
              {
                "name": "id",
                "value": "={{ $json.id }}"
              },
              {
                "name": "nombre",
                "value": "={{ $json.title }}"
              },
              {
                "name": "descripcion",
                "value": "={{ $json.descripcion }}"
              },
              {
                "name": "tipo producto",
                "value": "={{ $json.tipo_producto }}"
              }
            ]
          }
        }
      },
      "type": "@n8n/n8n-nodes-langchain.documentDefaultDataLoader",
      "typeVersion": 1,
      "position": [
        1900,
        -160
      ],
      "id": "c9653b55-dfab-4a48-9015-7664cd634a76",
      "name": "Default Data Loader"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.textSplitterRecursiveCharacterTextSplitter",
      "typeVersion": 1,
      "position": [
        2020,
        -40
      ],
      "id": "2842bd83-ffd5-4fbc-b2c6-9aecebdfbba2",
      "name": "Recursive Character Text Splitter"
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        2200,
        -320
      ],
      "id": "ce27efc6-e916-4e57-8ef1-a375fe30e5d2",
      "name": "Aggregate1"
    },
    {
      "parameters": {
        "model": "text-embedding-3-large",
        "options": {
          "dimensions": 1536
        }
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        2780,
        1240
      ],
      "id": "44e35db0-bd13-46a5-9bd1-f327b2b776aa",
      "name": "Embeddings OpenAI1",
      "credentials": {
        "openAiApi": {
          "id": "qLM5Iy3mjllZuUML",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "accessToken",
        "resource": "product",
        "operation": "getAll",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.shopifyTool",
      "typeVersion": 1,
      "position": [
        3120,
        1120
      ],
      "id": "82b844b2-2d95-4142-b145-688268dfeed2",
      "name": "Obtener Producto",
      "credentials": {
        "shopifyAccessTokenApi": {
          "id": "j1Nys3HNLxhnIk7y",
          "name": "Shopify Access Token account"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "mode": "retrieve-as-tool",
        "toolName": "ObtenerProductos",
        "toolDescription": "Utiliza esta herrramienta para obtener productos de shopify",
        "qdrantCollection": {
          "__rl": true,
          "value": "shopify",
          "mode": "id"
        },
        "topK": 20,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreQdrant",
      "typeVersion": 1.2,
      "position": [
        2720,
        1080
      ],
      "id": "55163df2-e1bc-4e36-8633-bf7215db6975",
      "name": "ObtenerProductos",
      "credentials": {
        "qdrantApi": {
          "id": "rg2NHi83Wt2pkwYi",
          "name": "QdrantApi account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "accessToken",
        "resource": "product",
        "operation": "get",
        "productId": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Product_ID', ``, 'string') }}",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.shopifyTool",
      "typeVersion": 1,
      "position": [
        2980,
        1140
      ],
      "id": "7a3f6881-7b47-4cbf-ac16-39bfaf28bd3c",
      "name": "Get Producto",
      "credentials": {
        "shopifyAccessTokenApi": {
          "id": "j1Nys3HNLxhnIk7y",
          "name": "Shopify Access Token account"
        }
      }
    }
  ],
  "pinData": {},
  "connections": {
    "descargar audio": {
      "main": [
        [
          {
            "node": "convertir audio",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "convertir audio": {
      "main": [
        [
          {
            "node": "OpenAI",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI": {
      "main": [
        [
          {
            "node": "audio content",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "descargar imagen": {
      "main": [
        [
          {
            "node": "convertir imagen",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "convertir imagen": {
      "main": [
        [
          {
            "node": "describe imagen",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "audio content": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "describe imagen": {
      "main": [
        [
          {
            "node": "image content",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "image content": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "text content": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 2
          }
        ]
      ]
    },
    "push mensaje": {
      "main": [
        [
          {
            "node": "Wait3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out": {
      "main": [
        [
          {
            "node": "Json Parse",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Json Parse": {
      "main": [
        [
          {
            "node": "Tipo Mensaje",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge": {
      "main": [
        [
          {
            "node": "Sort",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Sort": {
      "main": [
        [
          {
            "node": "Aggregate",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate": {
      "main": [
        [
          {
            "node": "Entrada Agente",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "borrar todos mensajes",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "No Operation, do nothing",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "obtener todos mensajes": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "borrar todos mensajes": {
      "main": [
        [
          {
            "node": "Split Out",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Auto-fixing Output Parser": {
      "ai_outputParser": [
        [
          {
            "node": "Verificador de Respuesta",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Structured Output Parser": {
      "ai_outputParser": [
        [
          {
            "node": "Auto-fixing Output Parser",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Verificador de Respuesta": {
      "main": [
        [
          {
            "node": "Enviar Parte1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "4o mini Verificador": {
      "ai_languageModel": [
        [
          {
            "node": "Verificador de Respuesta",
            "type": "ai_languageModel",
            "index": 0
          },
          {
            "node": "Auto-fixing Output Parser",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Enviar Parte1": {
      "main": [
        [
          {
            "node": "If Parte 2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If Parte 2": {
      "main": [
        [
          {
            "node": "Wait",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "If Parte 3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait": {
      "main": [
        [
          {
            "node": "Enviar Parte2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Enviar Parte2": {
      "main": [
        [
          {
            "node": "If Parte 3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If Parte 3": {
      "main": [
        [
          {
            "node": "Wait2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "No Operation, do nothing1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait2": {
      "main": [
        [
          {
            "node": "Enviar Parte3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Enviar Parte3": {
      "main": [
        [
          {
            "node": "No Operation, do nothing1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Postgres Chat Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "Limpiar Salida",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Entrada WhatsApp": {
      "main": [
        [
          {
            "node": "push mensaje",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook-WhatsApp": {
      "main": [
        [
          {
            "node": "Entrada WhatsApp",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait3": {
      "main": [
        [
          {
            "node": "obtener todos mensajes",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Tipo Mensaje": {
      "main": [
        [
          {
            "node": "descargar audio",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "descargar imagen",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "text content",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Entrada Agente": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Salida Agente": {
      "main": [
        [
          {
            "node": "Verificador de Respuesta",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Limpiar Salida": {
      "main": [
        [
          {
            "node": "Salida Agente",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Obtener Pedidos": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Editar Pedido": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Editar Producto": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Crear Producto": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Think": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Calculator": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "When clicking ‘Execute workflow’": {
      "main": [
        [
          {
            "node": "Shopify",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Shopify": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "Qdrant Vector Store",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Qdrant Vector Store": {
      "main": [
        [
          {
            "node": "Aggregate1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI": {
      "ai_embedding": [
        [
          {
            "node": "Qdrant Vector Store",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Default Data Loader": {
      "ai_document": [
        [
          {
            "node": "Qdrant Vector Store",
            "type": "ai_document",
            "index": 0
          }
        ]
      ]
    },
    "Recursive Character Text Splitter": {
      "ai_textSplitter": [
        [
          {
            "node": "Default Data Loader",
            "type": "ai_textSplitter",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate1": {
      "main": [
        [
          {
            "node": "Obtener Productos",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI1": {
      "ai_embedding": [
        [
          {
            "node": "ObtenerProductos",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "ObtenerProductos": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Get Producto": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "10be38e9-ad9e-4760-b01a-a6f8b70b6a57",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "9bf9145e22226d3dde31d69a2254018e4fb1eec7eb0d3a8fb5176a27c2816db5"
  },
  "id": "x3Sr2xF4Vz5iyHBr",
  "tags": []
}